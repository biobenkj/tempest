# Hybrid Training Configuration for Tempest
# Includes support for directory-based pseudo-labeling

# Model Architecture Configuration
model:
  max_seq_len: 1000
  num_labels: 6  # ADAPTER5, UMI, ACC, BARCODE, INSERT, ADAPTER3
  embedding_dim: 128
  lstm_units: 256
  lstm_layers: 2
  dropout: 0.3
  use_cnn: true
  use_bilstm: true
  batch_size: 32

# Data Simulation Configuration
simulation:
  n_train: 10000
  n_val: 2000
  n_test: 2000
  
  # Sequence component lengths
  sequence_lengths:
    ADAPTER5:
      min: 10
      max: 20
    UMI:
      min: 12
      max: 12
    ACC:
      min: 50
      max: 150
    BARCODE:
      min: 8
      max: 8
    INSERT:
      min: 100
      max: 400
    ADAPTER3:
      min: 10
      max: 20
  
  # Expected sequence order
  sequence_order:
    - ADAPTER5
    - UMI
    - ACC
    - BARCODE
    - INSERT
    - ADAPTER3
  
  # Noise parameters
  error_rate: 0.01
  indel_rate: 0.005

# Training Configuration
training:
  epochs: 50
  learning_rate: 0.001
  early_stopping_patience: 10
  reduce_lr_patience: 5
  checkpoint_dir: ./checkpoints

# Hybrid Training Configuration
hybrid:
  enabled: true
  
  # Training phases
  warmup_epochs: 5
  discriminator_epochs: 10
  pseudolabel_epochs: 10
  
  # Invalid read generation
  invalid_ratio: 0.15
  segment_loss_prob: 0.3
  segment_dup_prob: 0.3
  truncation_prob: 0.2
  chimeric_prob: 0.1
  scrambled_prob: 0.1
  
  # Loss weights
  invalid_weight_initial: 0.1
  invalid_weight_max: 0.3
  adversarial_weight: 0.1
  
  # Pseudo-labeling parameters
  confidence_threshold: 0.85
  confidence_decay: 0.95
  pseudo_weight: 0.5
  
  # Directory processing parameters
  max_pseudo_per_file: 1000      # Maximum pseudo-labels per FASTQ file
  max_pseudo_total: 10000        # Maximum total pseudo-labels across all files
  max_pseudo_examples: 10000     # Backward compatibility alias
  
  # Discriminator settings
  discriminator_lr_factor: 0.1
  discriminator_hidden_dim: 64
  
  # Architecture validation
  validate_architecture: true
  min_unique_segments: 3
  max_segment_repetition: 2

# Ensemble Configuration (optional)
ensemble:
  n_models: 3
  voting_method: soft  # 'soft' or 'hard'
  confidence_threshold: 0.8

# Inference Configuration
inference:
  batch_size: 128
  input_format: fastq  # 'fastq' or 'fasta'
  apply_barcode_correction: true
  barcode_correction_distance: 1
  deduplicate: true
  output_format: json  # 'json', 'tsv', or 'gff'
  min_confidence: 0.8

# PWM Configuration (optional)
pwm:
  pwm_file: null  # Path to PWM file for ACC generation
  min_score: 0.7
  scan_reverse_complement: true
